# 特徴量の詳細説明

## history_count と history_rate の定義

### 基本的な構造

このクロス時間評価では、**訓練期間**と**評価期間**という2つの異なる時期を使用しています。

**例: 0-3m → 0-3m パターン**
- **訓練期間**: 2021-01-01 ～ 2021-04-01（3ヶ月間）
- **評価期間**: 2023-01-01 ～ 2023-04-01（3ヶ月間）
- **期間の差**: 約2年

### 特徴量の計算方法

#### 1. `history_count`（レビュー依頼数）

**定義**: `len(reviewer_history)`

**意味**: **訓練期間中**にその開発者が受けたレビュー依頼の総数

**具体例**:
- パターン「0-3m → 0-3m」の場合
- `history_count = 96` → 2021年1月～4月の3ヶ月間に96件のレビュー依頼を受けた

**コード**（train_model.py:396, 627行目）:
```python
'history_request_count': len(reviewer_history)
```

#### 2. `history_rate`（承認率 / 継続率）

**定義**: `len(reviewer_history[accepted]) / len(reviewer_history)`

**意味**: **訓練期間中**の承認率（承認されたレビュー数 ÷ 全レビュー依頼数）

**具体例**:
- パターン「0-3m → 0-3m」、`history_count = 96`、`history_rate = 0.0833`
- → 2021年1月～4月に96件のレビュー依頼を受け、そのうち8件（8.33%）が承認された

**コード**（train_model.py:383, 616行目）:
```python
'acceptance_rate': len(reviewer_history[reviewer_history[label_col] == 1]) / len(reviewer_history)
```

### 予測タスクとの関係

**予測タスク**:
- **訓練期間中の活動（history_count, history_rate）** を使って
- **評価期間での継続/離脱** を予測する

**タイムライン図**:
```
2021年                        2022年              2023年
  |------ 訓練期間 ------|                |------ 評価期間 ------|
  |   (0-3m: 1-4月)     |                |   (0-3m: 1-4月)     |
  |                      |                |                      |
  ↓                      ↓                ↓                      ↓
history_count = 96                     true_label = 0 or 1
history_rate = 8.33%                   (この期間に継続したか?)
```

### 重要な観察

#### 1. なぜ2年間の差があるのか？

- **訓練**: 2021年のデータでモデルを学習
- **評価**: 2023年の同じ時期で性能を検証
- **目的**: 時間的な汎化性能を測定（古いデータで学習→新しいデータで予測できるか？）

#### 2. `history_rate`の意味の変化

実は`history_rate`は2つの意味を持っています：

**a) 訓練期間中の承認率**
- 2021年1月～4月にレビュー依頼された案件のうち、承認された割合
- 例: 96件中8件承認 → 8.33%

**b) 将来の継続率の指標**
- 承認率が高い = プロジェクトに積極的に関与 = 継続しやすい
- 承認率が低い = 消極的 or 自動化 = 離脱しやすい

#### 3. CI/Bot系の特徴的なパターン

**例: openstack-ci@storpool.com**
- `history_count = 49` → かなりのレビュー数
- `history_rate = 0.0` → **承認率0%**
- `true_label = 0` → 実際に離脱

**→ 大量のレビュー依頼を受けるが、全て自動的に拒否（CI Botの典型的パターン）**

### IRLとRFの違い

#### Random Forest (RF)の戦略
- **`history_count`に大きく依存**: レビュー数が多い = 継続
- 単純な関連性: 「活動量が多い人は継続する」

**問題点**:
- CI/Botの大量活動を「継続」と誤認識
- `history_rate`（承認率）を軽視

#### Inverse Reinforcement Learning (IRL)の戦略
- **`history_count`と`history_rate`のバランス**を評価
- 行動の質を重視: 「どれだけ承認されているか」

**優位点**:
- 大量レビュー × 低承認率 = Bot/離脱パターンと認識
- 少量レビュー × 高承認率 = 積極的な継続者と認識

### 具体例での比較

#### Case 1: aleksey.stupnikov@gmail.com（離脱開発者）
- **訓練期間**: 2021年1月～4月
  - `history_count = 96` （中程度の活動）
  - `history_rate = 0.0833` （8.33%、低い承認率）
- **評価期間**: 2023年1月～4月
  - `true_label = 0` （離脱）
- **予測**:
  - RF: 0.99（継続と強く確信） ❌ → レビュー数96を重視
  - IRL: 0.455（離脱） ✓ → 承認率8.33%を重視

#### Case 2: maksim.malchuk@gmail.com（継続開発者）
- **訓練期間**: 2021年7月～10月
  - `history_count = 3` （非常に少ない）
  - `history_rate = 0.6667` （66.7%、非常に高い承認率）
- **評価期間**: 2023年10月～2024年1月
  - `true_label = 1` （継続）
- **予測**:
  - RF: 0.14（離脱と確信） ❌ → レビュー数3を重視
  - IRL: 0.479（継続） ✓ → 承認率66.7%を重視

### まとめ

| 特徴量 | 定義 | 期間 | 意味 |
|--------|------|------|------|
| `history_count` | レビュー依頼数 | 訓練期間（例: 2021年1-4月） | その期間の活動量 |
| `history_rate` | 承認率 | 訓練期間（例: 2021年1-4月） | その期間の活動の質（承認された割合） |
| `true_label` | 継続/離脱 | 評価期間（例: 2023年1-4月） | 予測対象（2年後に継続しているか） |

**IRLの成功要因**:
1. 活動の「量」（history_count）だけでなく「質」（history_rate）を重視
2. CI/Botの「大量活動 × 低承認率」パターンを識別
3. 「少量活動 × 高承認率」の積極的な開発者を正しく評価
