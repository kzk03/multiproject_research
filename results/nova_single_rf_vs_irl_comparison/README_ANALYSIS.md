# 予測品質分析: 完全ガイド

## ドキュメント概要

このディレクトリには、Nova Single ProjectにおけるRandom ForestとIRLの**予測品質の詳細分析**が含まれています。

## ドキュメント一覧

### 📊 [prediction_quality_analysis.md](prediction_quality_analysis.md) ⭐⭐⭐ 必読
**どのような開発者を予測できているか・できていないかの詳細分析**（45-60分）

**内容**:
- IRLが正解、RFが不正解のケース（8件、53%）
- RFが正解、IRLが不正解のケース（1件、7%）
- 両モデルが不正解のケース（4件、27%）
- 開発者プロファイル別の予測精度
- 実務的な示唆と推奨構成

**こんな人におすすめ**:
- どのようなケースで各モデルが有効か知りたい
- 実際の開発者の例を見たい
- なぜ予測が当たる/外れるのか理解したい

### 📈 [comparison_analysis.md](comparison_analysis.md) ⭐⭐⭐ 概要把握
**全体的な性能比較**（25-40分）

すでに作成済みの包括的な比較分析。

### 🔬 [detailed_insights.md](detailed_insights.md) ⭐⭐ 深掘り
**モデルのメカニズムと改善方向**（40-60分）

すでに作成済みの深層考察。

### 📁 データファイル
- [model_comparison_detailed.csv](model_comparison_detailed.csv) - 15開発者の詳細比較データ
- [detailed_predictions.csv](detailed_predictions.csv) - 予測結果の生データ
- [prediction_analysis.json](prediction_analysis.json) - 統計サマリー

## クイックサマリー

### 驚くべき結果

| 観点 | IRL (0-3m→6-9m) | RF (6-9m→6-9m) | 差分 |
|------|-----------------|----------------|------|
| **正解率** | **67%** (10/15) | 20% (3/15) | **+47%** |
| **IRL のみ正解** | 8件 (53%) | - | - |
| **RF のみ正解** | - | 1件 (7%) | - |
| **両方不正解** | - | 4件 (27%) | - |

### IRLが正解、RFが不正解の開発者の特徴

```
平均履歴リクエスト: 625件（全体平均の1.9倍）
平均受諾率: 24%（全体平均の1.5倍）
特徴: ヘビーユーザー、実績あり、初期から一貫
```

**代表例**:
- **gibizer@gmail.com**: 905リクエスト、30%受諾率
  - IRL: ✓ 正解（確率0.484）
  - RF: ✗ 不正解（確率0.451）

- **smooney@redhat.com**: 641リクエスト、28%受諾率、評価期間66リクエスト
  - IRL: ✓ 正解（確率0.487）
  - RF: ✗ 不正解（確率0.407）

### 両モデルが不正解の開発者の特徴

```
平均履歴リクエスト: 215件（中程度）
平均受諾率: 22%（やや低め）
IRL確率: 0.461（閾値0.471に近い）
特徴: ボーダーラインケース、予測困難
```

**パターン**: 全て偽陰性（継続すると予測できなかった）

## 主要な発見

### 1. IRLの圧倒的優位性

**6-9m期間での正解率**: IRL 67% vs RF 20%（3倍以上の差）

**なぜIRLが優れているか**:
- 初期3ヶ月のデータから将来6-9ヶ月後を予測する**時間的汎化能力**
- 開発者の「本質的な特性」を学習（報酬関数）
- 高活動者のパターンを初期データから的確に把握

### 2. IRLが得意な開発者像

#### タイプA: ヘビーユーザー（継続者）
```
履歴リクエスト: 600+ 件
受諾率: 24-30%
評価期間活動: 活発（20+リクエスト）

IRLの判断: 初期の高活動 → 将来も継続
結果: 正解 ✓
```

#### タイプB: ライトユーザー（離脱者）
```
履歴リクエスト: <100 件
受諾率: <10%
評価期間活動: なしor極少

IRLの判断: 初期の低活動 → 離脱
結果: 正解 ✓
```

### 3. 両モデルが苦手な開発者像

#### タイプC: ボーダーライン（継続者）
```
履歴リクエスト: 100-300 件（中程度）
受諾率: 15-25%（やや低め）
IRL確率: 0.46-0.48（閾値ギリギリ）

両モデルの判断: 中途半端なシグナル → 離脱と予測
実際: 継続（予測困難な行動変化）
結果: 不正解 ✗
```

**難しい理由**:
- 継続とも離脱とも言い切れない活動量
- 確率が閾値に非常に近い（0.01の差で判断が変わる）
- 過去のパターンが将来を示唆しない

## 実務への応用

### 推奨モデル選択フロー

```
開発者プロファイルを取得
    ↓
履歴リクエスト数 > 500?
    ↓ Yes
  【IRL使用】
  - 信頼度: 高
  - 継続予測に強い
  - 初期データから将来予測
    ↓ No
    ↓
履歴リクエスト数 < 100?
    ↓ Yes
  【両モデルOK、RFを推奨】
  - 実装が容易
  - 離脱予測に強い
    ↓ No
    ↓
【ハイブリッド or 人間判断】
  - ボーダーラインケース
  - アンサンブル推奨
  - 重要な場合は人間が最終判断
```

### 実装例

```python
def predict_continuation(developer_profile):
    history_requests = developer_profile['history_request_count']

    if history_requests > 500:
        # 高活動者: IRLを信頼
        prediction = irl_model.predict(developer_profile)
        confidence = 'high'

    elif history_requests < 100:
        # 低活動者: RFで十分（実装容易）
        prediction = rf_model.predict(developer_profile)
        confidence = 'medium'

    else:
        # 中活動者: ハイブリッド
        irl_prob = irl_model.predict_proba(developer_profile)
        rf_prob = rf_model.predict_proba(developer_profile)

        # 加重平均（IRLを重視）
        ensemble_prob = 0.7 * irl_prob + 0.3 * rf_prob
        prediction = (ensemble_prob > threshold)

        # ボーダーライン判定
        if 0.46 < ensemble_prob < 0.52:
            confidence = 'low'  # 人間の判断を推奨
        else:
            confidence = 'medium'

    return prediction, confidence
```

## ケーススタディ: 詳細例

### ケース1: IRLの成功例（gibizer@gmail.com）

```
開発者プロファイル:
  - 履歴: 905リクエスト（15名中トップ）
  - 受諾率: 30%
  - 評価期間: 22リクエスト、2承諾

予測結果:
  IRL (0-3m→6-9m): 0.484 → 継続 ✓ 正解
  IRL (6-9m→6-9m): 0.481 → 継続 ✓ 正解
  RF:              0.451 → 離脱 ✗ 不正解

分析:
  IRLが成功した理由:
    - 初期3ヶ月で905リクエストという圧倒的実績を学習
    - 報酬関数で「経験の蓄積」が高い動機と認識
    - 将来も継続すると正確に予測

  RFが失敗した理由:
    - 確率0.451は閾値0.5をわずかに下回る
    - 訓練データ6-9m期間に類似の高活動者が少なかった
    - 分布シフトの影響を受けた
```

### ケース2: 両モデル失敗例（melwittt@gmail.com）

```
開発者プロファイル:
  - 履歴: 463リクエスト（多い）
  - 受諾率: 20%（やや低い）
  - 評価期間: 28リクエスト、4承諾（活発！）

予測結果:
  IRL (0-3m→6-9m): 0.463 → 離脱 ✗ 不正解
  IRL (6-9m→6-9m): 0.481 → 継続 ✓ 正解
  RF:              0.393 → 離脱 ✗ 不正解

分析:
  両モデルが失敗した理由:
    - 確率0.463は閾値0.471に極めて近い（差0.008）
    - 受諾率20%が継続の判断を困難にした
    - 活動量は多いが、受諾率が足を引っ張った

  IRLの対角線モデルは成功:
    - 6-9m期間のデータを使えば正解できる
    - より新しいデータが重要

  改善案:
    - 閾値を0.46に下げる
    - または受諾率よりも活動量を重視する特徴量エンジニアリング
```

## 統計的洞察

### 予測精度と開発者特性の関係

| 開発者タイプ | 履歴リクエスト | 受諾率 | IRL正解率 | RF正解率 |
|--------------|----------------|--------|-----------|----------|
| **ヘビーユーザー** | 600+ | 24%+ | **100%** (5/5) | 0% (0/5) |
| **ライトユーザー** | <100 | <10% | **100%** (3/3) | 67% (2/3) |
| **ミディアム（継続）** | 100-300 | 15-25% | **0%** (0/4) | 0% (0/4) |

**重要な示唆**:
- ヘビーユーザーの継続予測: IRLの独壇場
- ライトユーザーの離脱予測: 両モデルとも強い
- ミディアムユーザー: 両モデルとも苦手（最大の課題）

### 確率分布と予測精度

```
IRL確率が0.48-0.50: 正解率 80%（閾値を超える）
IRL確率が0.46-0.48: 正解率 20%（閾値ギリギリ、ボーダーライン）
IRL確率が0.44-0.46: 正解率 60%（閾値を下回る）

RF確率が0.40-0.50: 正解率 17%（ほぼ全て不正解）
RF確率が0.30-0.40: 正解率 33%（やや改善）
```

**洞察**:
- IRL: 閾値0.471が適切に設定されている
- RF: 確率が全体的に低く、閾値0.5が高すぎる可能性

## 今後の研究課題

### 1. ボーダーラインケースの改善

**課題**: IRL確率0.46-0.48のケースで正解率が低い

**解決策候補**:
- 追加特徴量（時系列トレンド、ソーシャル要因）
- 閾値の動的調整
- アンサンブル学習

### 2. RFの時間的汎化能力の向上

**課題**: RFは分布シフトに弱い

**解決策候補**:
- ドメイン適応手法
- 時間特徴量の追加
- Transfer Learning

### 3. ミディアムユーザーの予測精度向上

**課題**: 履歴100-300リクエストの開発者の予測が困難

**解決策候補**:
- セグメント別モデルの開発
- より詳細な特徴量（コミット数、イシュー参加など）
- 外部要因（プロジェクトの変化）の考慮

## まとめ

### 主要な結論

1. **IRLの圧倒的優位性**: 6-9m期間で67%の正解率（RFの3倍）
2. **ヘビーユーザーへの対応**: IRLは600+リクエストの開発者を100%正解
3. **ボーダーラインの課題**: 両モデルとも中程度の活動者に弱い
4. **実務での推奨**: 活動量に応じたモデル選択が重要

### 最終推奨

**プロダクション環境での構成**:
```
高活動者（500+）: IRL（信頼度: 高）
低活動者（<100）: RF（実装容易）
中活動者（100-500）: ハイブリッド + 人間判断
```

**期待される効果**:
- 全体の予測精度向上（推定: 70%以上）
- ボーダーラインケースの適切な処理
- コスト効率の良い実装

---

## 関連ドキュメント

- [comparison_analysis.md](comparison_analysis.md) - 全体的な性能比較
- [detailed_insights.md](detailed_insights.md) - モデルのメカニズム分析
- [README.md](README.md) - ディレクトリの概要

## データファイル

- [model_comparison_detailed.csv](model_comparison_detailed.csv)
- [detailed_predictions.csv](detailed_predictions.csv)
- [prediction_analysis.json](prediction_analysis.json)

**作成日**: 2025-12-21
**分析対象**: OpenStack Nova（6-9m期間、15開発者）
**モデル**: IRL (0-3m→6-9m) vs RF (6-9m→6-9m)
