# 特徴量重要度分析：RFとIRLの比較

**作成日**: 2025-12-25
**対象**: OpenStack Novaプロジェクトにおけるレビュア継続予測

---

## 実験設定

本分析では、**訓練期間 ≤ 評価期間の10パターン**を対象とした[^experiment_setup]：

| パターン | 訓練期間 | 評価期間 | 訓練サンプル | 評価サンプル |
|---------|---------|---------|------------|------------|
| 0-3m → 0-3m | 2019-01-01 ~ 2021-04-01 (sliding) | 2023-01-01 ~ 2023-04-01 | 1,372 | 67 |
| 0-3m → 3-6m | 2019-01-01 ~ 2021-04-01 (sliding) | 2023-04-01 ~ 2023-07-01 | 1,372 | 68 |
| 0-3m → 6-9m | 2019-01-01 ~ 2021-04-01 (sliding) | 2023-07-01 ~ 2023-10-01 | 1,372 | 58 |
| 0-3m → 9-12m | 2019-01-01 ~ 2021-04-01 (sliding) | 2023-10-01 ~ 2024-01-01 | 1,372 | 63 |
| 3-6m → 3-6m | 2019-01-01 ~ 2021-07-01 (sliding) | 2023-04-01 ~ 2023-07-01 | 1,618 | 68 |
| 3-6m → 6-9m | 2019-01-01 ~ 2021-07-01 (sliding) | 2023-07-01 ~ 2023-10-01 | 1,618 | 58 |
| 3-6m → 9-12m | 2019-01-01 ~ 2021-07-01 (sliding) | 2023-10-01 ~ 2024-01-01 | 1,618 | 63 |
| 6-9m → 6-9m | 2019-01-01 ~ 2021-10-01 (sliding) | 2023-07-01 ~ 2023-10-01 | 1,876 | 58 |
| 6-9m → 9-12m | 2019-01-01 ~ 2021-10-01 (sliding) | 2023-10-01 ~ 2024-01-01 | 1,876 | 63 |
| 9-12m → 9-12m | 2019-01-01 ~ 2022-01-01 (sliding) | 2023-10-01 ~ 2024-01-01 | 2,129 | 63 |

**重要な特性**:
- すべてのパターンで訓練期間（2019-2021/2022）が評価期間（2023）より前
- 時系列分割により、未来のデータでモデルを評価（データリーク回避）
- Sliding Window方式により、訓練サンプル数を1,372～2,129に拡張
- 評価期間は2023年の各四半期（3ヶ月単位）で分割

[^experiment_setup]: データソース: [outputs/singleproject/rf_nova_case1_sliding_10patterns/results.json](../../../outputs/singleproject/rf_nova_case1_sliding_10patterns/results.json)。RF Case1（Sliding Window）の10パターン評価結果。特徴量重要度は、この10パターンで訓練されたRFモデルから抽出。

---

## 1. Random Forestの特徴量重要度（定量的分析）

### 1.1 特徴量重要度ランキング

Random Forestモデルが学習した特徴量重要度（Gini係数ベース）は以下の通り[^rf_importance1]：

| 順位 | 特徴量 | 重要度 | カテゴリ | 解釈 |
|------|--------|--------|---------|------|
| 1 | **avg_response_time** | 0.266 | 行動 | 平均応答時間（最重要） |
| 2 | **total_reviews** | 0.255 | 状態 | 総レビュー数 |
| 3 | **recent_activity_frequency** | 0.162 | 状態 | 直近の活動頻度 |
| 4 | **experience_days** | 0.093 | 状態 | 経験日数 |
| 5 | **avg_activity_gap** | 0.066 | 状態 | 平均活動間隔 |
| 6 | **recent_acceptance_rate** | 0.042 | 状態 | 直近30日の受諾率 |
| 7 | **avg_action_intensity** | 0.041 | 行動 | 平均行動強度 |
| 8 | **review_load** | 0.037 | 状態 | レビュー負荷 |
| 9 | **avg_review_size** | 0.035 | 行動 | 平均レビュー規模 |
| 10 | **activity_trend** | 0.003 | 状態 | 活動トレンド |
| - | total_changes | 0.000 | 状態 | （影響なし） |
| - | collaboration_score | 0.000 | 状態 | （影響なし） |
| - | code_quality_score | 0.000 | 状態 | （影響なし） |
| - | avg_collaboration | 0.000 | 行動 | （影響なし） |

[^rf_importance1]: データソース: [outputs/analysis_data/nova_single_rf_comparison/rf_results/rf_nova_single_feature_importance.csv](../../../outputs/analysis_data/nova_single_rf_comparison/rf_results/rf_nova_single_feature_importance.csv)。Random Forestの`feature_importances_`属性（Gini importanceベース）から算出。

### 1.2 RFが重視する特徴量の特性

**上位3特徴量が全体の68.3%を占める**という極端な集中が見られる：
- `avg_response_time` (26.6%): **スカラー値としての平均応答時間**
- `total_reviews` (25.5%): **スカラー値としての総数**
- `recent_activity_frequency` (16.2%): **スカラー値としての頻度**

#### 重要な観察

1. **受諾率（acceptance_rate）の重要度が低い（4.2%、第6位）**
   - 本研究の16ケース分析では、受諾率15%以上が継続シグナル、5%未満が離脱シグナルであることが示された
   - しかし、RFは受諾率をそれほど重視していない
   - 理由: スカラー値としての受諾率は、「大量リクエスト数」と負の相関を持つため、`total_reviews`に情報が吸収されている可能性

2. **活動トレンド（activity_trend）の重要度が極めて低い（0.3%、第10位）**
   - トレンド（increasing/stable/decreasing）は時系列パターンの本質
   - RFではこれを単なる3値（1.0/0.0/-1.0）のカテゴリ変数として扱う
   - 時間的な変化の文脈が失われているため、判別力が低下

3. **応答時間が最重要（26.6%）**
   - Christian Rohmannケースの13分応答など、応答速度は継続の強いシグナル
   - しかし、RFは**平均値のみ**を見ており、「いつ」応答したかの文脈を欠く

---

## 2. IRLモデルの特徴量影響（定性的分析）

IRLモデルはLSTMベースであり、単純な特徴量重要度スコアを算出できない。代わりに、16ケース分析から帰納的に導出された**時系列パターンの重要性**を整理する。

### 2.1 IRLが学習した重要パターン

#### パターンA: 受諾率の時系列変化（最重要）

**時系列トレンドとしての受諾率**がIRLの予測を支配している：

| パターン | 時系列例 | 判定 | 該当ケース |
|---------|---------|------|---------|
| 減少トレンド | `[0.5 → 0.4 → 0.3 → 0.1 → 0.0]` | 離脱 | jichenjc@cn.ibm.com |
| 急上昇後安定 | `[0.0 → 0.33 → 0.33 → 0.33 → 0.20]` | 継続 | christian.rohmann@inovex.de |
| 低位安定 | `[0.2 → 0.2 → 0.2 → 0.2 → 0.2]` | 継続 | sahid.ferdjaoui@... |
| 完全ゼロ | `[0.0 → 0.0 → 0.0 → 0.0 → 0.0]` | 離脱 | hejie.xu@intel.com |
| 超低受諾（CI） | `[0.01 → 0.01 → 0.01 → 0.01]` | 離脱 | nova_hyperv_ci@... |

**RFとの決定的な差**:
- RF: 受諾率の**平均値**（例: 0.20）を閾値判定
- IRL: 受諾率の**時系列シーケンス**（例: `[0, 0.33, 0.33, 0.33, 0.20]`）からトレンドを学習

#### パターンB: 応答速度の文脈情報（重要）

**応答速度の質的シグナル**：
- Christian Rohmann: **3月に13分で応答**という「いつ」「どれだけ速く」の組み合わせ
- RF: 平均応答時間28日という集約値のみ → 文脈喪失

#### パターンC: リクエスト数の時系列パターン（重要）

**CIボット検出における時系列的一貫性**：
- nova_hyperv_ci: 毎月40-116件という**持続的な大量リクエスト**
- RF: 総数725件という集約値 → 「重要な開発者」と誤認
- IRL: 月次パターン`[116, 93, 85, 40, ...]`の一貫性 → CIボットと判定

### 2.2 IRLの暗黙的特徴量重要度（推定）

16ケース分析から、IRLが**実際に予測に使用した特徴量の影響力**を推定すると：

| 順位 | 特徴量（時系列形式） | 推定重要度 | 根拠 |
|------|-------------------|----------|------|
| 1 | **acceptance_rate (時系列)** | 極めて高 | 16ケース全てで言及、トレンドが決定的 |
| 2 | **response_time (文脈付き)** | 高 | Christian Rohmannの13分応答が分岐点 |
| 3 | **activity_gap (変化)** | 中〜高 | 間隔の拡大/縮小がトレンドを補強 |
| 4 | **total_reviews (月次)** | 中 | CIボット検出に重要（異常値検出） |
| 5 | **activity_trend (トレンド)** | 中 | increasing/decreasingが明示的シグナル |
| 6 | **experience_days (文脈)** | 低〜中 | hejie.xuケース（4年在籍なのに受諾率0%） |

**RFとの比較**:
- RF: `avg_response_time`（26.6%）> `acceptance_rate`（4.2%）
- IRL: `acceptance_rate（時系列）`（極めて高）> `response_time（文脈付き）`（高）

---

## 3. 両モデルの特徴量重要度の比較

### 3.1 定量的比較（上位5特徴量）

| 順位 | RF（スカラー値） | 重要度 | IRL（推定、時系列） | 推定重要度 |
|------|----------------|--------|-------------------|-----------|
| 1 | avg_response_time | 26.6% | acceptance_rate (時系列) | 極めて高 |
| 2 | total_reviews | 25.5% | response_time (文脈付き) | 高 |
| 3 | recent_activity_frequency | 16.2% | activity_gap (変化) | 中〜高 |
| 4 | experience_days | 9.3% | total_reviews (月次) | 中 |
| 5 | avg_activity_gap | 6.6% | activity_trend (トレンド) | 中 |

#### 重要な違い

1. **受諾率の位置付けが逆転**
   - RF: 第6位（4.2%）← 上位5に入らない
   - IRL: 第1位（極めて高）← 最重要

2. **トレンドの扱い**
   - RF: activity_trend = 第10位（0.3%）← ほぼ無視
   - IRL: activity_trend = 第5位（中）← トレンドが本質

3. **応答時間の文脈**
   - RF: 平均値として第1位だが、**いつ応答したか**は不明
   - IRL: 文脈付きで第2位、**3月の13分応答**が鍵

### 3.2 特徴量の「使い方」の差異

#### ケーススタディ: Christian Rohmann

**RFの判定ロジック**:
```python
avg_response_time = 28日  # 重要度26.6%（第1位）→ 離脱シグナル
total_reviews = 5件      # 重要度25.5%（第2位）→ 経験不足
acceptance_rate = 0.20   # 重要度4.2%（第6位）→ 低いが影響小
→ 総合判定: 離脱（確率0.08）✗
```

**IRLの判定ロジック**:
```python
acceptance_rate = [0, 0.33, 0.33, 0.33, 0.20]  # 推定重要度：極めて高
                                                # トレンド: 急上昇後安定 → 継続シグナル
response_time = 3月に13分  # 推定重要度：高
                           # 文脈: 応答した月=3月、速度=13分 → 高関与
total_reviews = [1, 2, 2, 0, 0] (月次)  # 推定重要度：中
                                        # パターン: 3月にピーク後継続 → 継続シグナル
→ 総合判定: 継続（確率0.475）✓
```

---

## 4. なぜ重要度が逆転するのか：考察

### 4.1 集約による情報損失とミスリーディング

**受諾率がRFで低重要度になる理由**:

1. **大量リクエスト数との負の相関**
   - CIボット: `total_reviews=725, acceptance_rate=0.006`
   - 人間レビュア: `total_reviews=5, acceptance_rate=0.20`
   - RFの決定木は`total_reviews`で先に分割し、受諾率の情報を吸収

2. **閾値判定の限界**
   - `acceptance_rate < 0.5`という単純な分割では、0.20（継続）と0.05（離脱）を区別できない
   - IRLは`[0.2, 0.2, 0.2]`（安定＝継続）と`[0.5, 0.3, 0.1]`（減少＝離脱）を区別

3. **時間的変化の欠如**
   - 平均0.20は、`[0, 0, 0.40, 0.40]`（急上昇）と`[0.40, 0.40, 0, 0]`（急降下）を区別できない

### 4.2 時系列表現による本質的特徴量の発見

**IRLが受諾率を最重視する理由**:

1. **トレンドが本質的シグナル**
   - 離脱者11ケース：8ケースが減少トレンドまたは完全ゼロ
   - 継続者5ケース：全てが安定または上昇トレンド

2. **文脈情報の統合**
   - 「初期のゼロ」（新規参加）vs「終期のゼロ」（離脱）を区別可能
   - 「一時的な低下」vs「持続的な減少」を区別可能

3. **閾値の動的学習**
   - RFの固定閾値0.5ではなく、IRLは文脈依存の判定を学習
   - 例: 安定的な0.2は継続、減少中の0.2は離脱

### 4.3 応答時間の解釈の違い

**RFが応答時間を最重視（26.6%）する理由**:
- 継続者は平均応答時間が短い（< 30日）
- 離脱者は平均応答時間が長い（> 30日）
- 単純な線形相関が強いため、Gini重要度が高い

**IRLが応答時間を第2位（文脈付き）にする理由**:
- **いつ応答したか**（例: 3月に応答）が受諾率トレンドを補強
- **応答速度の質**（例: 13分）が関与度の高さを示す
- 受諾率トレンドの方が予測により直接的な影響を与える

---

## 5. 実用的示唆

### 5.1 特徴量エンジニアリングへの示唆

1. **時系列データでは、トレンド特徴量が集約値より重要**
   - `acceptance_rate`の平均値（RF: 4.2%）< 時系列トレンド（IRL: 極めて高）
   - 集約値モデルでも、トレンド指標（傾き、標準偏差、最大-最小など）を明示的に追加すべき

2. **文脈情報の重要性**
   - 「いつ」「どのように」という時間的文脈が予測精度を左右
   - スカラー値モデルでも、時間窓ごとの集約値（例: 直近3ヶ月の受諾率）を追加すべき

3. **相関に基づく特徴量選択の危険性**
   - RFは`total_reviews`と`acceptance_rate`の負の相関により、後者を軽視
   - ドメイン知識（受諾率が継続の本質的指標）を優先すべき

### 5.2 モデル選択への示唆

1. **時系列データには時系列モデルを使用**
   - 集約値モデル（RF、SVM、ロジスティック回帰）は時間情報を失う
   - LSTM、GRU、Transformerなどの時系列モデルが本質的に有利

2. **解釈可能性と性能のトレードオフ**
   - RFの特徴量重要度は解釈しやすいが、時系列文脈を欠くため誤導的
   - IRLの学習パターンは解釈が難しいが、本質的な因果関係を捉える

3. **ドメイン知識による検証**
   - 機械学習モデルの重要度スコアは、必ずしも因果的重要性を反映しない
   - 16ケースのような定性的分析で、モデルの判断根拠を検証すべき

---

## 6. 結論

### 6.1 主要な発見

1. **RFとIRLで特徴量重要度が逆転**
   - RF: `avg_response_time`（26.6%）> `total_reviews`（25.5%）> `acceptance_rate`（4.2%）
   - IRL: `acceptance_rate（時系列）`（極めて高）> `response_time（文脈付き）`（高）

2. **逆転の原因は表現形式の差異**
   - RF: スカラー値（平均、合計）→ 時間情報喪失、相関に基づく特徴量吸収
   - IRL: 時系列シーケンス → トレンド、文脈、パターンを学習

3. **ドメイン知識（受諾率が本質）がIRLで実現**
   - 16ケース分析で示された「受諾率15%以上=継続」がIRLの学習と一致
   - RFは受諾率を軽視し、リクエスト数に惑わされる

### 6.2 論文への統合

本分析は、DISCUSSION_FOR_PAPER.mdの以下のセクションに統合すべき：

1. **セクション5.1「同一特徴量、異なる利用形態」**
   - RFとIRLの特徴量重要度の逆転（受諾率4.2% vs 極めて高）
   - 定量的証拠として特徴量重要度表を追加

2. **セクション5.3「パターン学習と閾値学習の対比」**
   - RFの閾値ベース判定（`avg_response_time < threshold`）
   - IRLのパターンマッチング（`[0, 0.33, 0.33, 0.33] ≈ Pattern D`）

3. **新セクション「特徴量重要度の比較分析」**
   - 定量的比較表（RF Gini重要度 vs IRL推定重要度）
   - Christian Rohmannケースでの判定ロジック比較
   - 実用的示唆（特徴量エンジニアリング、モデル選択）

---

**データソース**:
- RF特徴量重要度: [outputs/analysis_data/nova_single_rf_comparison/rf_results/rf_nova_single_feature_importance.csv](../../../outputs/analysis_data/nova_single_rf_comparison/rf_results/rf_nova_single_feature_importance.csv)
- IRL推定重要度: [COMPREHENSIVE_IRL_ANALYSIS.md](COMPREHENSIVE_IRL_ANALYSIS.md)の16ケース分析から帰納的に導出
- RF実装: [scripts/analysis/compare_irl_vs_rf_nova_single.py](../../../scripts/analysis/compare_irl_vs_rf_nova_single.py)
