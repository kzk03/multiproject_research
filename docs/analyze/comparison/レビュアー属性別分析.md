# レビュー承諾予測におけるレビュアー属性別の性能分析

## タスクの説明

本研究では、**コードレビュー承諾予測（Review Acceptance Prediction）**タスクに取り組んでいます。

- **目的**: 特定のレビュアーがコードレビュー依頼を承諾するか拒否するかを予測
- **入力**: レビュアーの過去の活動履歴、プロジェクト情報、時系列特徴
- **出力**: 承諾確率（0-1の値）

## レビュアー属性の定義

レビュアーを以下の3つの軸で分類して分析しました：

### 1. 経験レベル（Experience Level）
過去のレビュー依頼数に基づく分類：
- **Novice（初心者）**: ≤10件
- **Intermediate（中級者）**: 11-50件
- **Advanced（上級者）**: 51-150件
- **Expert（エキスパート）**: >150件

### 2. 過去の承諾率（Past Acceptance Rate）
履歴期間における承諾率：
- **Low（低い）**: <30%
- **Medium（中程度）**: 30-50%
- **High（高い）**: 50-70%
- **Very High（非常に高い）**: >70%

### 3. 活動レベル（Activity Level）
評価期間におけるレビュー依頼数：
- **Inactive（非活動的）**: ≤5件
- **Moderate（中程度）**: 6-20件
- **Active（活動的）**: 21-50件
- **Very Active（非常に活動的）**: >50件

---

## 主要な発見

### 1. 経験レベルによる予測性能の違い

#### Single Project (Nova)での傾向

| 経験レベル | サンプル数 | 実際の承諾率 | Precision | Recall | F1 Score |
|-----------|-----------|-------------|-----------|--------|----------|
| Novice | 288 | 12.5% | 0.263 | 0.278 | 0.270 |
| Intermediate | 176 | 27.3% | 0.326 | 0.583 | 0.418 |
| Advanced | 128 | 43.8% | 0.577 | 0.536 | 0.556 |
| **Expert** | 192 | **68.8%** | **0.735** | **0.924** | **0.819** |

**重要な観察:**
- 経験豊富なレビュアーほど予測精度が高い
- Expertレベルでは**F1=0.819**と非常に高い性能
- Noviceレベルでは性能が著しく低い（F1=0.270）
- **実際の承諾率も経験とともに増加**（12.5% → 68.8%）

#### Multi-Project (No OS)での特異な傾向

| 経験レベル | サンプル数 | 実際の承諾率 | Precision | Recall | F1 Score |
|-----------|-----------|-------------|-----------|--------|----------|
| Novice | 183 | 76.0% | 0.764 | **1.0** | 0.866 |
| Intermediate | 233 | 85.0% | 0.850 | **1.0** | 0.919 |
| Advanced | 170 | 85.9% | 0.859 | **1.0** | 0.924 |
| Expert | 83 | 89.2% | 0.892 | **1.0** | 0.943 |

**注目すべき点:**
- すべての経験レベルで**Recall=1.0**（完全検出）
- これは前述の極端なクラス不均衡（承諾率76-89%）に起因
- 経験レベルによる性能差は小さい

#### Multi-Project (2x OS)での改善された傾向

| 経験レベル | サンプル数 | 実際の承諾率 | Precision | Recall | F1 Score |
|-----------|-----------|-------------|-----------|--------|----------|
| Novice | 349 | 34.1% | 0.370 | 0.756 | 0.497 |
| Intermediate | 222 | 57.2% | 0.575 | 0.992 | 0.728 |
| Advanced | 208 | 59.1% | 0.591 | 1.000 | 0.743 |
| Expert | 205 | 45.4% | 0.451 | 0.989 | 0.620 |

**興味深い発見:**
- オーバーサンプリングにより、より現実的な承諾率（34-59%）
- IntermediateとAdvancedレベルで最も高い性能
- Expertレベルでの性能低下は、より複雑な判断パターンを示唆

---

### 2. 過去の承諾率による予測性能

#### Single Project (Nova)

| 過去承諾率 | サンプル数 | 実際の承諾率 | Precision | Recall | F1 Score |
|-----------|-----------|-------------|-----------|--------|----------|
| Low (<30%) | 636 | 32.7% | 0.548 | 0.712 | 0.619 |
| Medium (30-50%) | 100 | 52.0% | 0.643 | 0.692 | 0.667 |
| High (50-70%) | 32 | 25.0% | 0.500 | 0.500 | 0.500 |
| Very High (>70%) | 16 | 25.0% | 0.250 | 0.500 | 0.333 |

**重要な洞察:**
- 過去の承諾率が中程度（30-50%）のレビュアーで最も高い性能
- **High/Very Highカテゴリーで実際の承諾率が低い（25%）**のは興味深い
  - これは過去の行動が必ずしも将来を予測しないことを示唆
  - または、プロジェクトの性質が変化した可能性

#### Multi-Project (2x OS)

| 過去承諾率 | サンプル数 | 実際の承諾率 | Precision | Recall | F1 Score |
|-----------|-----------|-------------|-----------|--------|----------|
| Low (<30%) | 843 | 43.1% | 0.451 | 0.917 | 0.604 |
| **Medium (30-50%)** | 104 | **77.9%** | **0.800** | **0.988** | **0.884** |
| High (50-70%) | 12 | 50.0% | 0.500 | 1.000 | 0.667 |
| Very High (>70%) | 25 | 48.0% | 0.522 | 1.000 | 0.686 |

**発見:**
- Medium範囲のレビュアーで最も高い性能（F1=0.884）
- Low範囲のレビュアーでも高いRecall（0.917）を維持

---

### 3. 活動レベルによる予測性能

#### Single Project (Nova)

| 活動レベル | サンプル数 | 実際の承諾率 | Precision | Recall | F1 Score |
|-----------|-----------|-------------|-----------|--------|----------|
| Inactive (≤5) | 472 | 12.7% | 0.161 | 0.317 | 0.213 |
| Moderate (6-20) | 132 | 45.5% | 0.529 | 0.617 | 0.569 |
| Active (21-50) | 108 | 81.5% | 0.830 | 0.886 | 0.857 |
| **Very Active (>50)** | 72 | **88.9%** | **0.933** | **0.875** | **0.903** |

**明確な傾向:**
- **活動的なレビュアーほど承諾率が高い**（12.7% → 88.9%）
- **活動的なレビュアーほど予測精度が高い**（F1: 0.213 → 0.903）
- これは、活動的なレビュアーの行動パターンがより安定していることを示唆

#### Multi-Project (No OS)

| 活動レベル | サンプル数 | 実際の承諾率 | Precision | Recall | F1 Score |
|-----------|-----------|-------------|-----------|--------|----------|
| Inactive (≤5) | 208 | 52.4% | 0.527 | 1.0 | 0.690 |
| Moderate (6-20) | 167 | 92.2% | 0.922 | 1.0 | 0.960 |
| Active (21-50) | 135 | **100.0%** | **1.000** | **1.0** | **1.000** |
| Very Active (>50) | 159 | **100.0%** | **1.000** | **1.0** | **1.000** |

**極端なパターン:**
- Active/Very Activeレベルで完全な予測精度
- これは、活動的なレビュアーがほぼすべて承諾していることに起因

#### Multi-Project (2x OS)

| 活動レベル | サンプル数 | 実際の承諾率 | Precision | Recall | F1 Score |
|-----------|-----------|-------------|-----------|--------|----------|
| Inactive (≤5) | 353 | 14.7% | 0.149 | 0.788 | 0.250 |
| Moderate (6-20) | 213 | 57.3% | 0.579 | 0.926 | 0.713 |
| Active (21-50) | 155 | 77.4% | 0.778 | 0.933 | 0.848 |
| Very Active (>50) | 263 | 63.9% | 0.637 | 0.982 | 0.773 |

**より現実的なパターン:**
- オーバーサンプリングにより、より均衡した分布
- 活動的なレビュアーで高い性能を維持

---

## エラーパターンの詳細分析

### False Positive（承諾すると予測したが実際は拒否）の特徴

#### Single Project (Nova)
- **件数**: 152件
- **平均経験**: 186.9レビュー（Expertレベル）
- **平均過去承諾率**: 15.5%（非常に低い）
- **平均予測確率**: 0.475

**解釈:**
- 経験豊富だが過去の承諾率が低いレビュアー
- モデルは経験を重視しすぎた可能性
- **過去の承諾率をより重視すべき**

#### Multi-Project (2x OS)
- **件数**: 443件
- **平均経験**: 83.4レビュー
- **平均過去承諾率**: 9.0%（極めて低い）
- **平均予測確率**: 0.459

**解釈:**
- 過去の承諾率が極めて低いレビュアーを誤って予測
- 複数プロジェクトの影響で、プロジェクト間の転移が困難

### False Negative（拒否すると予測したが実際は承諾）の特徴

#### Single Project (Nova)
- **件数**: 82件
- **平均経験**: 156.7レビュー
- **平均過去承諾率**: 18.5%
- **平均予測確率**: 0.465（低い）

**解釈:**
- 過去の承諾率が低いが、実際には承諾したケース
- レビュアーの行動変化を捉えきれていない

#### Multi-Project (2x OS)
- **件数**: 31件（非常に少ない）
- **平均経験**: 8.9レビュー（Novice）
- **平均過去承諾率**: 2.5%（極めて低い）
- **平均予測確率**: 0.313（非常に低い）

**解釈:**
- ほとんどがNoviceレベルのレビュアー
- 過去のデータが少ないため予測が困難
- **コールドスタート問題**

#### Multi-Project (No OS)
- **件数**: 0件（False Negativeなし）
- **Recall=1.0**のため、すべての承諾を検出

---

## キャリブレーション分析

予測確率と実際の承諾率の一致度を分析しました。

### 主要な発見

1. **Single Project (Nova)**
   - Expert/Advancedレベルで良好なキャリブレーション
   - Noviceレベルで予測が過大評価される傾向

2. **Multi-Project (No OS)**
   - すべてのレベルで予測確率が実際より低め
   - これは、極端な不均衡により閾値が高く設定されたため

3. **Multi-Project (2x OS)**
   - 最も良好なキャリブレーション
   - 特にIntermediateレベルで予測確率と実際の承諾率が一致

4. **Multi-Project (3x OS)**
   - 2x OSと類似のパターン
   - わずかに予測が控えめになる傾向

---

## 実用的な推奨事項

### 1. レビュアー属性に応じた予測戦略

#### Expertレベルのレビュアー
- **推奨設定**: Single Project または Multi-Project (No OS)
- **理由**: 最も高い予測精度（F1=0.82-0.94）
- **注意点**: 過去の承諾率を重視すべき

#### Intermediate/Advancedレベルのレビュアー
- **推奨設定**: Multi-Project (2x OS)
- **理由**: 最もバランスの取れた性能（F1=0.73-0.74）
- **注意点**: オーバーサンプリングにより、より現実的な予測

#### Noviceレベルのレビュアー
- **課題**: すべての設定で性能が低い（F1=0.27-0.50）
- **推奨**:
  - より保守的な閾値設定
  - 他の特徴量（プロジェクト類似度、専門性など）の追加
  - コールドスタート問題への対処（デフォルト値の設定など）

### 2. 活動レベルに応じた戦略

#### Very Active/Activeレビュアー
- すべての設定で高い予測精度
- 承諾率も高いため、優先的に依頼すべき候補

#### Inactive/Moderateレビュアー
- 予測精度が低い
- 追加の文脈情報（最近の活動、専門分野など）が必要

### 3. 過去の承諾率の活用

#### Medium範囲（30-50%）のレビュアー
- 最も予測しやすい
- 安定した行動パターン

#### Low範囲（<30%）のレビュアー
- False Positiveのリスクが高い
- より高い閾値を設定すべき

#### High/Very High範囲（>50%）のレビュアー
- Single Projectでは実際の承諾率が低下する傾向
- プロジェクトの変化や個人的事情の影響を考慮すべき

---

## 今後の改善方向

### 1. レビュアー属性を明示的にモデル化
現在のモデルは暗黙的に属性を学習していますが、明示的に以下を組み込むことで改善可能：
- 経験レベルのエンコーディング
- 過去の承諾率の時系列変化
- 活動パターンの周期性

### 2. コールドスタート問題への対処
- デフォルト承諾率の設定
- 類似レビュアーからの転移学習
- プロジェクト全体の承諾率を初期値として使用

### 3. 時系列での行動変化のモデル化
- レビュアーの承諾率が時間とともに変化
- 最近の活動により高い重みを付ける
- 季節性やプロジェクトフェーズの考慮

### 4. プロジェクト間の転移学習の改善
- プロジェクト類似度の計算
- レビュアーの専門分野とプロジェクトのマッチング
- クロスプロジェクトでの行動パターンの抽出

### 5. アンサンブルモデル
- 属性ごとに専用モデルを訓練
- 予測時に属性に応じてモデルを選択
- または、複数モデルの重み付き平均

---

## 結論

レビュアー属性別の分析により、以下の重要な知見を得ました：

1. **経験レベルが最も重要な予測因子**
   - Expertレベルで最高の予測精度（F1=0.82-0.94）
   - Noviceレベルで大きな課題（F1=0.27-0.50）

2. **活動レベルと承諾率には強い相関**
   - Very Activeレビュアーの承諾率: 88.9%（Single Project）
   - Inactiveレビュアーの承諾率: 12.7%（Single Project）

3. **過去の承諾率は重要だが絶対的ではない**
   - Medium範囲（30-50%）で最も予測しやすい
   - High/Very High範囲でも将来の承諾率が低下する場合あり

4. **オーバーサンプリングにより、より現実的な評価が可能**
   - 極端な不均衡下では、すべてを「承諾」と予測する戦略が最適化される
   - オーバーサンプリングにより、より洗練された識別が可能に

5. **False Positiveの主要原因は過去の承諾率の低さ**
   - 経験豊富でも承諾率が低いレビュアーを誤予測
   - 過去の承諾率をより重視すべき

実用システムでは、レビュアーの属性に応じて：
- 閾値を動的に調整
- 追加の文脈情報を活用
- 複数のモデルを組み合わせる

ことで、より高精度なレビュー承諾予測が可能になると考えられます。

---

## 補足: 生成されたリソース

### 可視化（`docs/figures/reviewer_analysis/`）
1. `performance_by_experience.png` - 経験レベル別の性能
2. `performance_by_past_acceptance.png` - 過去承諾率別の性能
3. `performance_by_activity.png` - 活動レベル別の性能
4. `calibration_by_experience.png` - キャリブレーション分析

### CSVファイル（各実験設定ごと）
- `analysis_by_experience_level.csv`
- `analysis_by_past_acceptance_category.csv`
- `analysis_by_activity_level.csv`
