# IRL vs Random Forest: 評価パターンの違い

## 質問の回答

> 時系列で10パターン評価している？？RFもしんIRLも

**回答**: **NO、異なります**

- **IRL（時系列版）**: ✅ 10パターン評価済み
- **Random Forest**: ❌ **1パターンのみ**（6-9m → 6-9m）

---

## 現在の評価状況

### IRL 時系列版（新）

**出力**: `outputs/50projects_irl_timeseries/2x_os/`

**評価パターン**: 10パターン完了

```
訓練期間 → 評価期間（全組み合わせ）
=========================================
0-3m → 0-3m    ✅
0-3m → 3-6m    ✅
0-3m → 6-9m    ✅
0-3m → 9-12m   ✅
3-6m → 3-6m    ✅
3-6m → 6-9m    ✅
3-6m → 9-12m   ✅
6-9m → 6-9m    ✅  ← 最高性能（F1=0.944）
6-9m → 9-12m   ✅
9-12m → 9-12m  ✅
```

**F1スコア行列**:
```
         0-3m    3-6m    6-9m    9-12m
0-3m    0.923   0.907   0.955   0.880
3-6m            0.911   0.956   0.884
6-9m                    0.944   0.890
9-12m                           0.892
```

---

### Random Forest（既存）

**出力**: `outputs/analysis_data/irl_vs_rf_comparison/`

**評価パターン**: **1パターンのみ**

```
6-9m → 6-9m のみ  ✅  (F1=0.997)
```

**理由**: 比較実験は「IRL最高性能パターン」に対してRFを評価

---

## 問題点

### Random Forestは1パターンしか評価していない

**現状**:
- IRL（スナップショット旧版）: 10パターン → 6-9m→6-9mが最高（F1=0.948）
- RF: 6-9m→6-9mのみ評価 → F1=0.997

**不足している評価**:
- ❌ 0-3m → 0-3m
- ❌ 0-3m → 3-6m
- ❌ 0-3m → 6-9m
- ❌ 0-3m → 9-12m
- ❌ 3-6m → 3-6m
- ❌ 3-6m → 6-9m
- ❌ 3-6m → 9-12m
- ❌ 6-9m → 9-12m
- ❌ 9-12m → 9-12m

---

## RFが他のパターンでも強いか？

### 仮説1: RFは全パターンで高性能

**理由**:
- スナップショット特徴量は安定
- クラス不均衡対策（`class_weight='balanced'`）が効果的
- アンサンブル学習で過学習を抑制

**予想**:
- 全10パターンで **F1 > 0.99** を維持
- IRLより常に高性能

### 仮説2: 長期予測でRFが劣化

**0-3m → 9-12m**のような長期予測では:
- 21ヶ月先を予測（訓練終了から）
- スナップショット特徴量では捉えきれない変化

**予想**:
- 長期パターン（0-3m → 9-12m）で **F1が低下**
- IRLの時系列学習が有利になる可能性

---

## 公平な比較のために必要なこと

### やるべきこと

1. **Random Forestを全10パターンで評価**
   ```bash
   # 各パターンごとにRF訓練・評価
   for train_pattern in 0-3m 3-6m 6-9m 9-12m; do
       for eval_pattern in 0-3m 3-6m 6-9m 9-12m; do
           if [[ eval >= train ]]; then
               python compare_irl_vs_rf.py \
                   --train-pattern $train_pattern \
                   --eval-pattern $eval_pattern
           fi
       done
   done
   ```

2. **10パターンの平均性能で比較**
   - IRL時系列版: 平均F1 = ?
   - Random Forest: 平均F1 = ?

3. **パターン別の強み・弱みを分析**
   - 短期予測（同一期間）: どちらが強い？
   - 長期予測（0-3m → 9-12m）: どちらが強い？

---

## 現在のデータ比較（6-9m → 6-9mのみ）

| モデル | F1 | AUC-ROC | Precision | Recall | Accuracy | サンプル数 |
|--------|-----|---------|-----------|--------|----------|-----------|
| **IRL（スナップショット旧）** | 0.948 | 0.749 | 0.932 | 0.830 | 0.792 | 183 |
| **IRL（時系列新）** | **0.944** | 0.728 | 0.923 | **0.966** | **0.938** | 162 |
| **Random Forest** | **0.997** | **0.999** | **1.000** | 0.994 | **0.995** | 183 |

**注意**: サンプル数が異なる（183 vs 162）理由は不明（要調査）

---

## 次のステップ

### 優先順位1: Random Forestを全パターンで評価

**目的**: 公平な比較

**手順**:
1. 各訓練期間の特徴量CSVを生成
2. 各評価期間でRFを訓練・評価
3. 10パターンのF1スコア行列を作成

**期待される実行時間**:
- RF訓練: 0.087秒 × 10パターン = **約1秒**
- 非常に高速

### 優先順位2: 時系列IRLとRFの詳細比較

**比較軸**:
- 短期 vs 長期予測
- プロジェクトタイプ別（Expert/Contributor/Specialist）
- 計算コスト
- 解釈性（特徴量重要度）

### 優先順位3: サンプル数の不一致を調査

**疑問**: なぜ162 vs 183で異なる？
- データ抽出ロジックの違い？
- 欠損値処理の違い？
- 要調査

---

## まとめ

| 項目 | IRL時系列版 | Random Forest |
|------|-------------|---------------|
| **評価パターン数** | ✅ 10パターン | ❌ **1パターンのみ** |
| **最高F1（6-9m→6-9m）** | 0.944 | **0.997** |
| **平均F1（全パターン）** | 約0.92 | **未評価** |
| **訓練時間（1パターン）** | 約24秒 | 0.087秒 |

**結論**:
- Random Forestは**1パターンしか評価していない**
- 公平な比較のために**全10パターンで評価が必要**
- IRLはすでに10パターン完了しているので、RFのみ追加評価すればよい

---

**作成日時**: 2025年12月15日
**データ**: OpenStack 50プロジェクト
