# レビュー承諾予測における特徴量の詳細分析と考察

## エグゼクティブサマリー

本研究では、**単一プロジェクト（10次元状態+4次元行動）** と **複数プロジェクト（14次元状態+5次元行動）** という異なる特徴量セットを用いてレビュー承諾予測を行いました。

### 主要な発見

1. **特徴量次元の違いが性能に与える影響は限定的**
   - 統計的には有意差あり（p < 0.05）だが、**クラス不均衡の影響がより支配的**
   - 複数プロジェクト特徴量の追加（+4次元）による本質的な改善は小さい

2. **AUC-ROCで見ると単一プロジェクトが優位**
   - Single Project: 0.758 ± 0.088
   - Multi-Project (No OS): 0.571 ± 0.122
   - **識別能力は単一プロジェクトの方が高い**（p = 0.0005）

3. **オーバーサンプリングによりAUC-ROCが大幅改善**
   - No OS: 0.571 → 2x OS: 0.696 → 3x OS: 0.705
   - これは、複数プロジェクト特徴量の真価を発揮するために**均衡したデータが必要**であることを示唆

---

## 特徴量の詳細定義

### 1. 単一プロジェクト特徴量（状態10次元 + 行動4次元）

#### 状態特徴量（DeveloperState: 10次元）

レビュアーの現在の状態を表現する特徴量：

1. **total_reviews** (float): 総レビュー依頼数
2. **acceptance_rate** (float): 全期間の承諾率（0-1）
3. **average_response_time_days** (float): 平均応答時間（日数）
4. **total_reviews_last_30_days** (int): 直近30日のレビュー数
5. **total_reviews_last_90_days** (int): 直近90日のレビュー数
6. **total_reviews_last_180_days** (int): 直近180日のレビュー数
7. **total_reviews_last_365_days** (int): 直近365日のレビュー数
8. **max_concurrent_reviews** (int): 最大同時レビュー数
9. **recent_acceptance_rate** (float): 直近30日の承諾率（0-1）
10. **review_load** (float): レビュー負荷（直近30日 / 平均）

**設計思想:**
- 時間窓を変えた活動量（30/90/180/365日）で、短期・中期・長期のパターンを捉える
- 承諾率の全体 vs 直近で、行動変化を検出
- レビュー負荷で、現在の多忙度を表現

#### 行動特徴量（DeveloperAction: 4次元）

レビュアーの個別のレビュー依頼への応答を表現：

1. **action_type** (str → categorical): レビュー依頼のタイプ
   - 実装では`intensity`などにエンコード
2. **intensity** (float): 行動の強度（変更ファイル数ベース、正規化済み）
3. **collaboration** (float): 協力度（0-1）
4. **response_time** (float): 応答時間（日数、正規化済み）

**設計思想:**
- レビュー依頼の規模（intensity）を考慮
- 協力的な行動（collaboration）を重視
- 応答速度（response_time）で即応性を評価

---

### 2. 複数プロジェクト特徴量（状態14次元 + 行動5次元）

#### 追加された状態特徴量（+4次元）

11. **project_count** (int): 参加プロジェクト数
    - 1プロジェクトのみ: 専門家
    - 複数プロジェクト: ジェネラリスト

12. **project_activity_distribution** (float): プロジェクト間の活動分散度（0-1）
    - 0に近い: 特定のプロジェクトに集中
    - 1に近い: 複数プロジェクトに均等に分散

13. **main_project_contribution_ratio** (float): メインプロジェクトへの貢献率（0-1）
    - メインプロジェクト = 最も活動が多いプロジェクト
    - 高い値: メインプロジェクトに注力

14. **cross_project_collaboration_score** (float): プロジェクト横断協力スコア（0-1）
    - 複数プロジェクトでの協力的な活動の度合い
    - 高い値: プロジェクト横断的に活発

**設計思想:**
- プロジェクト多様性（project_count）
- 活動の集中度（activity_distribution, main_project_contribution_ratio）
- クロスプロジェクトでの協力性（cross_project_collaboration_score）
- これらにより、レビュアーの「プロジェクト横断的な行動パターン」を捉える

#### 追加された行動特徴量（+1次元）

5. **is_cross_project** (bool → 0/1): プロジェクト横断的な行動かどうか
   - レビュー依頼が自分のメインプロジェクト外から来た場合に1

**設計思想:**
- レビュアーにとって「よく知らないプロジェクト」からの依頼は承諾率が異なる可能性
- クロスプロジェクトレビューの難易度を考慮

---

## 特徴量の統計的分析

### 特徴量次元と性能の関係

#### F1スコア

| 設定 | 総次元数 | F1（同一期間） | F1（未来期間） |
|------|---------|--------------|--------------|
| Single Project (Nova) | 14 (10+4) | 0.636 ± 0.058 | 0.671 ± 0.067 |
| Multi-Project (No OS) | 19 (14+5) | **0.918 ± 0.046** | **0.900 ± 0.055** |
| Multi-Project (2x OS) | 19 (14+5) | 0.654 ± 0.042 | 0.638 ± 0.021 |
| Multi-Project (3x OS) | 19 (14+5) | 0.655 ± 0.030 | 0.634 ± 0.015 |

**観察:**
- 複数プロジェクト特徴量（+5次元）を追加しても、F1スコアは必ずしも向上しない
- **No OSでのF1=0.918は、特徴量の効果ではなく、クラス不均衡（89.9% positive）に起因**

#### AUC-ROC（真の識別能力）

| 設定 | 総次元数 | AUC-ROC（同一期間） | AUC-ROC（未来期間） |
|------|---------|-------------------|-------------------|
| Single Project (Nova) | 14 (10+4) | **0.754 ± 0.051** | **0.832 ± 0.059** |
| Multi-Project (No OS) | 19 (14+5) | 0.635 ± 0.051 | 0.527 ± 0.135 |
| Multi-Project (2x OS) | 19 (14+5) | 0.697 ± 0.034 | 0.696 ± 0.048 |
| Multi-Project (3x OS) | 19 (14+5) | **0.712 ± 0.023** | **0.700 ± 0.037** |

**重要な発見:**
- **単一プロジェクト（14次元）が最高のAUC-ROC（0.754-0.832）**
- 複数プロジェクト特徴量（19次元）は、**オーバーサンプリングなしではAUC-ROCが低下**（0.527-0.635）
- **オーバーサンプリングにより、複数プロジェクト特徴量が効果を発揮**（0.696-0.712）

### 統計的検定結果

#### Single Project vs Multi-Project (No OS)

| 指標 | Single Project | Multi-Project | p-value | 結論 |
|------|---------------|--------------|---------|------|
| F1 Score | 0.621 ± 0.078 | 0.907 ± 0.052 | **0.0000** | 有意差あり |
| Precision | 0.593 ± 0.115 | 0.835 ± 0.089 | **0.0004** | 有意差あり |
| Recall | 0.707 ± 0.176 | 1.000 ± 0.000 | **0.0000** | 有意差あり |
| **AUC-ROC** | **0.758 ± 0.088** | **0.571 ± 0.122** | **0.0005** | **有意差あり（Single優位）** |

**解釈:**
- F1/Precision/Recallでは複数プロジェクトが優位だが、これは**クラス不均衡の影響**
- **AUC-ROCでは単一プロジェクトが有意に優位**
- これは、複数プロジェクト特徴量が必ずしも識別能力を向上させないことを示唆

#### オーバーサンプリング間の比較（複数プロジェクト）

| 比較 | F1 p-value | AUC-ROC p-value | 結論 |
|------|-----------|----------------|------|
| No OS vs 2x OS | **0.0002** | **0.0028** | 有意差あり |
| No OS vs 3x OS | **0.0002** | **0.0013** | 有意差あり |
| 2x OS vs 3x OS | 0.7621 | 0.5205 | 有意差なし |

**解釈:**
- オーバーサンプリングにより、F1は低下するがAUC-ROCは向上
- 2x OSと3x OSには有意差なし → **2倍で十分**

---

## クラス不均衡の影響の詳細分析

### Single Project (Nova)

**クラス分布:**
- Positive（承諾）率: 31.0% - 41.0%（平均約35%）
- **比較的均衡している**

**性能:**
- F1: 0.621 ± 0.078
- AUC-ROC: **0.758 ± 0.088**
- Precision-Recallバランス: 良好

**混同行列（集計）:**
```
                Predicted
                Rejected  Accepted
Actual Rejected   221       228      (49.2% precision on rejected)
Actual Accepted   82        253      (75.5% recall)
```

**観察:**
- モデルは両クラスをある程度区別できている
- False Positive（228件）とFalse Negative（82件）のバランスが取れている
- **AUC-ROCが高いことから、識別能力は良好**

### Multi-Project (No OS)

**クラス分布:**
- Positive率: 74.2% - 96.8%（平均約**85.3%**）
- **極端に不均衡**

**性能:**
- F1: 0.907 ± 0.052（見かけ上高い）
- AUC-ROC: **0.571 ± 0.122**（実際は低い）
- Recall: **1.000**（すべて承諾と予測）

**混同行列（集計）:**
```
                Predicted
                Rejected  Accepted
Actual Rejected    0        111     (0% recall on rejected)
Actual Accepted    0        558     (100% recall on accepted)
```

**観察:**
- **モデルはすべてを「承諾」と予測している**
- False Negative = 0（承諾を見逃すことはない）
- False Positive = 111（拒否を誤って承諾と予測）
- これは、「すべて承諾と予測する戦略」が最適化された結果
- **AUC-ROC=0.571は、ランダムよりわずかにマシな程度**

### Multi-Project (2x OS)

**クラス分布:**
- Positive率: 42.2% - 51.5%（平均約**47.4%**）
- **オーバーサンプリングにより均衡化**

**性能:**
- F1: 0.644 ± 0.042
- AUC-ROC: **0.696 ± 0.048**
- Precision-Recallバランス: 改善

**混同行列（集計）:**
```
                Predicted
                Rejected  Accepted
Actual Rejected   50       443      (10.1% precision on rejected)
Actual Accepted   31       460      (93.7% recall on accepted)
```

**観察:**
- False Negative = 31（わずか6.3%を見逃す）
- False Positive = 443（拒否の89.9%を誤予測）
- **Recall重視の戦略**
- AUC-ROCが0.696と、No OSの0.571から大幅に改善
- これは、**複数プロジェクト特徴量が均衡データで効果を発揮**していることを示す

### Multi-Project (3x OS)

**クラス分布:**
- Positive率: 42.2% - 51.5%（2x OSと同じ）

**性能:**
- F1: 0.642 ± 0.015（2x OSとほぼ同じ）
- AUC-ROC: **0.705 ± 0.037**（わずかに向上）

**混同行列（集計）:**
```
                Predicted
                Rejected  Accepted
Actual Rejected   73       420      (14.8% precision on rejected)
Actual Accepted   44       447      (91.0% recall on accepted)
```

**観察:**
- 2x OSと比べて、False Negativeが増加（31 → 44）
- False Positiveは減少（443 → 420）
- **よりバランスの取れた予測**
- AUC-ROCが最高値（0.705）を記録

---

## 特徴量の効果に関する深い考察

### 1. なぜ複数プロジェクト特徴量はNo OSで効果を発揮しないのか？

#### 仮説1: クラス不均衡による学習阻害

**メカニズム:**
```
極端な不均衡（89.9% positive）
↓
「すべて承諾と予測」が最適戦略に
↓
複雑な特徴量（project_count, cross_project_collaborationなど）を学習するインセンティブがない
↓
モデルは単純な「常にpositive」関数に収束
↓
AUC-ROC = 0.571（低い）
```

**証拠:**
- Recall = 1.000（すべてpositive予測）
- 混同行列で Actual Rejected → Predicted Accepted = 111件、Rejected = 0件
- 複数プロジェクト特徴量の情報が活用されていない

#### 仮説2: 複数プロジェクト特徴量は「拒否」の予測に重要

**観察:**
- プロジェクト横断的なレビュー依頼（is_cross_project=1）は拒否されやすい可能性
- しかし、No OSではnegative（拒否）が10.1%しかなく、この パターンを学習できない

**オーバーサンプリング後:**
- Negativeが48.5-52.2%に増加
- モデルが「どのような場合に拒否されるか」を学習可能に
- is_cross_project=1などの特徴が効果を発揮
- AUC-ROC改善（0.571 → 0.696）

### 2. なぜ単一プロジェクト特徴量はAUC-ROCが高いのか？

#### 仮説1: 特徴量の一貫性

**単一プロジェクト（Nova）の利点:**
- すべてのレビュアーが同じプロジェクト文脈
- プロジェクト固有の暗黙知が特徴量に反映されやすい
- 例: 「direct_acceptance_rate=0.8」の意味が一貫

**複数プロジェクトの課題:**
- プロジェクトAでの「acceptance_rate=0.8」とプロジェクトBでの「0.8」は異なる意味を持つ可能性
- プロジェクト間の文化的差異を特徴量が完全に捉えきれていない

#### 仮説2: データ量 vs データ品質

**単一プロジェクト:**
- 予測数: 784
- 高品質な一貫したデータ

**複数プロジェクト:**
- 予測数: 669（No OS）、984（2x/3x OS）
- データ量は多いが、プロジェクト間のノイズあり

**結論:**
- データ量の増加が必ずしも性能向上につながらない
- **データの一貫性**と**特徴量の意味の明確さ**が重要

### 3. オーバーサンプリングが複数プロジェクト特徴量を「解放」する

#### Before（No OS）:
```
Negative: 10.1%
↓
モデル: 「全部positive予測でいいや」
↓
複数プロジェクト特徴量: 未使用
↓
AUC-ROC: 0.571
```

#### After（2x/3x OS）:
```
Negative: 48-52%
↓
モデル: 「ちゃんと区別しないと」
↓
複数プロジェクト特徴量を活用:
  - is_cross_project: クロスプロジェクトレビューは拒否されやすい
  - project_activity_distribution: 集中型レビュアーは承諾しやすい
  - cross_project_collaboration_score: 協力的なレビュアーを識別
↓
AUC-ROC: 0.696-0.705
```

**証拠:**
- オーバーサンプリングによりAUC-ROCが大幅改善（p < 0.01）
- False Negativeが31-44件発生（negativeの識別を開始）
- 予測確率の分布が二峰性に（承諾/拒否の区別ができている）

---

## 予測確率分布の分析

### Single Project (Nova)

**分布の特徴:**
- **二峰性の分布**
  - 承諾: 予測確率0.45-0.50付近にピーク
  - 拒否: 予測確率0.44-0.48付近にピーク（わずかに低い）
- 閾値: 0.456
- **分離度はあるが、重なりが大きい**

**解釈:**
- モデルは両クラスを区別しているが、確信度は中程度
- これは、レビュー承諾が多くの要因に依存する複雑なタスクであることを示す

### Multi-Project (No OS)

**分布の特徴:**
- **ほぼ単峰性**
  - すべてが0.60-0.75付近に集中
  - 承諾/拒否の区別がほとんどない
- 閾値: 0.465

**解釈:**
- モデルはほとんど区別できていない
- 「やや高めの確率」をすべてに割り当てている
- これは、不均衡下での「安全策」（すべてpositive予測）

### Multi-Project (2x OS)

**分布の特徴:**
- **二峰性の分布（改善）**
  - 承諾: 0.40-0.50付近にピーク
  - 拒否: 0.35-0.45付近にピーク
- 閾値: 0.401
- **分離度が向上**

**解釈:**
- オーバーサンプリングにより、モデルが両クラスを区別し始めた
- 複数プロジェクト特徴量が効果を発揮
- ただし、Single Projectほど明確ではない

### Multi-Project (3x OS)

**分布の特徴:**
- 2x OSと類似
- わずかに分離度が向上

**解釈:**
- 2x → 3xの改善は限定的
- 過学習のリスクを考慮すると、2xで十分

---

## 実用的な推奨事項

### 1. 特徴量の選択

#### 単一プロジェクトでの運用
**推奨:** 基本特徴量（10次元状態 + 4次元行動）

**理由:**
- AUC-ROC = 0.754-0.832と高い識別能力
- プロジェクト固有のパターンを効果的に学習
- シンプルな特徴量セットで解釈性が高い

**適用例:**
- 大規模な単一プロジェクト（Linux Kernel, Chromiumなど）
- プロジェクト固有の文化が強い環境

#### 複数プロジェクトでの運用
**推奨:** 拡張特徴量（14次元状態 + 5次元行動）**+ オーバーサンプリング（2倍）**

**理由:**
- 複数プロジェクト特徴量の効果を引き出すには均衡データが必要
- AUC-ROC = 0.696と実用的なレベル
- プロジェクト横断的な行動パターンを捉える

**適用例:**
- 企業内の複数プロジェクト
- オープンソース財団（OpenStack, Apache, CNCFなど）

### 2. データ収集戦略

#### 不均衡が予想される場合
- **必ずオーバーサンプリング（2倍）を適用**
- データ拡張手法を検討
- Cost-sensitive learningの導入

#### 均衡したデータが得られる場合
- 複数プロジェクト特徴量が効果を発揮
- より高度な特徴量（例: プロジェクト埋め込み）の追加を検討

### 3. モデル改善の方向性

#### 短期的改善

1. **プロジェクト埋め込みの導入**
   - 現在: project_countなどのスカラー値
   - 改善: プロジェクトごとの埋め込みベクトル
   - 期待効果: プロジェクト間の類似度を学習

2. **時系列特徴量の強化**
   - 現在: 30/90/180/365日の窓
   - 改善: LSTMなどで時系列パターンを直接学習
   - 期待効果: レビュアーの行動変化を捉える

3. **グラフ特徴量の追加**
   - レビュアー間のネットワーク構造
   - プロジェクト間の依存関係
   - 期待効果: 協力関係を明示的にモデル化

#### 中長期的改善

1. **マルチタスク学習**
   - 承諾予測 + 応答時間予測 + レビュー品質予測
   - 期待効果: 補助タスクによる正則化

2. **メタ学習の適用**
   - プロジェクトごとのモデルを素早く適応
   - Few-shot learningで新規プロジェクトに対応

3. **説明可能性の向上**
   - SHAP値による特徴量重要度の可視化
   - レビュアーへのフィードバック生成

---

## 結論

### 主要な知見

1. **特徴量次元の増加（14→19）が必ずしも性能向上につながらない**
   - クラス不均衡の影響の方が支配的
   - 複雑な特徴量は均衡データで初めて効果を発揮

2. **単一プロジェクト（14次元）が最高のAUC-ROC（0.832）を達成**
   - データの一貫性が重要
   - シンプルな特徴量セットでも十分な性能

3. **複数プロジェクト特徴量（19次元）はオーバーサンプリングで真価を発揮**
   - No OS: AUC-ROC = 0.571 → 2x OS: 0.696 → 3x OS: 0.705
   - is_cross_projectなどの特徴量が識別に貢献

4. **2倍オーバーサンプリングが最適**
   - 2x vs 3xに有意差なし（p = 0.52）
   - 過学習のリスクを避けつつ性能を確保

### 実用システムへの示唆

**単一プロジェクト環境:**
- 基本特徴量（14次元）で十分
- クラス不均衡対策が重要
- AUC-ROCを主要指標とすべき

**複数プロジェクト環境:**
- 拡張特徴量（19次元）+ オーバーサンプリング（2倍）を推奨
- プロジェクト横断的な特徴量の追加検討
- データの均衡化が性能の鍵

### 今後の研究方向

1. プロジェクト埋め込みの導入
2. 時系列モデル（LSTM, Transformer）の適用
3. グラフニューラルネットワークによる協力関係のモデル化
4. メタ学習による新規プロジェクトへの適応
5. 説明可能なAIによるレビュアーへのフィードバック

---

## 補足資料

### 生成された可視化

**包括的分析（`docs/figures/comprehensive/`）:**
1. `feature_dimensions.png` - 特徴量次元の比較
2. `performance_vs_features.png` - 特徴量次元と性能の関係
3. `prediction_distributions.png` - 予測確率の分布
4. `confusion_matrices.png` - 混同行列
5. `class_imbalance_impact.png` - クラス不均衡の影響

**全体分析（`docs/figures/`）:**
- performance_comparison.png
- temporal_heatmaps.png
- precision_recall_tradeoff.png
- oversampling_effect.png
- temporal_stability.png

**レビュアー属性分析（`docs/figures/reviewer_analysis/`）:**
- performance_by_experience.png
- performance_by_past_acceptance.png
- performance_by_activity.png
- calibration_by_experience.png

### 関連ドキュメント

- `docs/分析サマリー.md` - 日本語サマリー
- `docs/レビュアー属性別分析.md` - レビュアー属性別の詳細分析
- `docs/detailed_analysis.md` - 英語での詳細分析
- `docs/summary_report.md` - 包括的なレポート
