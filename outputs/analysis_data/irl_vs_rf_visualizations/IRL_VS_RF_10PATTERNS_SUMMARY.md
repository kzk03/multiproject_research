# IRL(Time-series 10パターン) vs RF (6-9m→6-9m 1パターン) 比較

**生成日時**: 2025年12月16日
**問題**: RFは1パターンしか評価していないため、IRL 10パターン平均との比較は不公平

## 現状の評価状況

### IRL (Time-series版): 10パターン評価済み ✓

| パターン | F1 | AUC-ROC | Recall | Precision | サンプル数 |
|----------|-----|---------|--------|-----------|-----------|
| 0-3m → 0-3m | 0.9231 | 0.6686 | 0.9936 | 0.8619 | 185 |
| 0-3m → 3-6m | 0.9073 | 0.5727 | 1.0000 | 0.8303 | 167 |
| 0-3m → 6-9m | 0.9550 | 0.5736 | 1.0000 | 0.9139 | 151 |
| 0-3m → 9-12m | 0.8800 | 0.5342 | 1.0000 | 0.7857 | 140 |
| 3-6m → 3-6m | 0.9108 | 0.6806 | 1.0000 | 0.8363 | 171 |
| 3-6m → 6-9m | 0.9559 | 0.5117 | 1.0000 | 0.9156 | 154 |
| 3-6m → 9-12m | 0.8837 | 0.6196 | 1.0000 | 0.7917 | 144 |
| **6-9m → 6-9m** | **0.9443** | **0.7284** | **0.9664** | **0.9231** | **162** |
| 6-9m → 9-12m | 0.8897 | 0.6599 | 1.0000 | 0.8014 | 146 |
| 9-12m → 9-12m | 0.8916 | 0.6610 | 1.0000 | 0.8043 | 138 |
| **平均** | **0.9141** | **0.6210** | **0.9960** | **0.8464** | **156** |

### Random Forest: 1パターンのみ ❌

| パターン | F1 | AUC-ROC | Recall | Precision | サンプル数 |
|----------|-----|---------|--------|-----------|-----------|
| 6-9m → 6-9m | 0.8946 | 0.7032 | 0.8485 | 0.9459 | 183 |

## 問題点

1. **評価パターン数の不均衡**
   - IRL: 10パターン（様々な時間窓で評価）
   - RF: 1パターンのみ（6-9m→6-9m）

2. **公平な比較ができない**
   - IRLの平均F1 (0.9141) vs RFの1パターンF1 (0.8946)を比較するのは不適切
   - 最良のパターン選択バイアスの可能性

3. **サンプル数の違い**
   - IRL 6-9m→6-9m: 162サンプル
   - RF 6-9m→6-9m: 183サンプル
   - データ分割方法が異なる可能性

## 現時点での限定的な比較（6-9m→6-9mパターンのみ）

### 同一パターン比較: 6-9m → 6-9m

| メトリクス | IRL (Time-series) | RF | 差分 (IRL - RF) | 勝者 |
|-----------|-------------------|-----|-----------------|------|
| **F1 Score** | **0.9443** | 0.8946 | **+0.0497 (+5.6%)** | ✓ IRL |
| **AUC-ROC** | **0.7284** | 0.7032 | **+0.0252 (+3.6%)** | ✓ IRL |
| AUC-PR | 0.9632 | **0.9526** | +0.0106 (+1.1%) | ✓ IRL |
| **Recall** | **0.9664** | 0.8485 | **+0.1179 (+13.9%)** | ✓ IRL |
| Precision | 0.9231 | **0.9459** | -0.0228 (-2.4%) | ✗ RF |
| Accuracy | **0.9228** | 0.8197 | **+0.1031 (+12.6%)** | ✓ IRL |

### 結論（6-9m→6-9mパターン）

✅ **IRLが6メトリクス中5つで勝利**（F1, AUC-ROC, AUC-PR, Recall, Accuracy）

**IRLの優位性**:
- F1スコア: +5.6%
- AUC-ROC: +3.6%（ユーザーの懸念に対する答え: IRLが勝っている）
- Recall: +13.9%（離脱者の見逃し削減）
- False Negative: IRL 5人 vs RF 25人（**20人削減**）

**RFの優位性**:
- Precision: +2.4%（誤報削減）

## 必要なアクション

### ✅ 完了済み

1. IRL Time-series版 10パターン評価完了
2. RF 6-9m→6-9m 1パターン評価完了（データリーク修正済み）
3. 6-9m→6-9mパターンでの詳細比較完了
4. 可視化6種類作成完了

### ⚠️ 未完了（公平な比較のために必要）

1. **RFを残り9パターンで評価**
   - 0-3m → 0-3m
   - 0-3m → 3-6m
   - 0-3m → 6-9m
   - 0-3m → 9-12m
   - 3-6m → 3-6m
   - 3-6m → 6-9m
   - 3-6m → 9-12m
   - 6-9m → 9-12m
   - 9-12m → 9-12m

2. **10パターン平均での公平な比較**
   - IRL 10パターン平均 vs RF 10パターン平均
   - パターンごとのIRL vs RF比較
   - 時間窓による性能変化の分析

## 推奨事項

### オプション1: 簡易比較（現状維持）

**メリット**:
- すでに完了している
- 6-9m→6-9mは代表的なパターン
- IRLの優位性を示せている

**デメリット**:
- 公平性に欠ける
- 論文・発表で指摘される可能性

### オプション2: 完全比較（推奨）

**実施内容**:
1. RFを残り9パターンで評価（約30-60分）
2. 10パターン全体での統計的比較
3. 時間窓依存性の分析

**メリット**:
- 完全に公平な比較
- 研究発表で自信を持って提示可能
- より詳細な洞察が得られる

**デメリット**:
- 追加の計算時間が必要

## 暫定結論（6-9m→6-9mパターンのみ）

**現時点での知見**:

1. **IRLが総合的に優位**
   - 6-9m→6-9mパターンで、IRLは5/6メトリクスで勝利
   - 特にRecall（+13.9%）とFalse Negative削減（20人）が顕著

2. **AUC-ROCでもIRLが勝利**
   - ユーザーの質問「時系列でもRFに勝ってる？AUC-ROC含め」
   - **回答: YES** - AUC-ROC 0.7284 vs 0.7032 (+3.6%)

3. **Precision以外は全てIRL優位**
   - RFが勝つのはPrecisionのみ（+2.4%）
   - 実用上、Recallの方が重要（離脱予測）

4. **時系列学習の優位性**
   - LSTMによる動的パターン学習が有効
   - Focal Lossによるクラス不均衡対応が機能

## 次のステップ

1. **RF 10パターン評価の実行決定**
   - ユーザーに確認: 完全な10パターン比較を実施するか？
   - または、6-9m→6-9mパターンのみで十分か？

2. **可視化の更新**
   - 10パターン評価が完了したら、全パターンの比較図を追加

3. **論文・発表用の最終レポート**
   - 完全な統計的比較
   - 時間窓による性能変化の考察
   - IRLが優位な理由の詳細分析

---

**現状まとめ**: 6-9m→6-9mパターンでは **IRLが明確に優位**（F1 +5.6%, AUC-ROC +3.6%, Recall +13.9%）。完全な公平性のためには、RFも10パターン評価が必要。
