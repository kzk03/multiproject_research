# 第4章 提案手法における特徴量定義

## 表4.2: 状態特徴量（10次元） - Nova単体プロジェクト用

**注**: 本研究ではOpenStack/Nova単一プロジェクトを対象としているため、マルチプロジェクト特徴量（プロジェクト数、活動分散度など4次元）は使用していない。

| # | 特徴量名 | 定義 | 正規化方法 |
|---|---------|------|-----------|
| 1 | 経験日数 | 初回活動から現在までの経過日数 | 730日(2年)でキャップ、0-1に正規化 |
| 2 | 総コミット数 | これまでの累積コミット数 | 500件でキャップ、0-1に正規化 |
| 3 | 総レビュー数 | これまでの累積レビュー数 | 500件でキャップ、0-1に正規化 |
| 4 | 最近の活動頻度 | 直近30日間の1日あたり平均活動量<br>(= 直近30日の活動数 / 30) | 0-1の範囲（事前正規化済み） |
| 5 | 平均活動間隔 | 連続する活動間の平均日数<br>(= Σ(次の活動日 - 前の活動日) / (活動数-1)) | 60日でキャップ、0-1に正規化 |
| 6 | 活動トレンド | 直近30日と30-60日前の活動数比較<br>• 比率 > 1.2 → 増加(1.0)<br>• 比率 < 0.8 → 減少(0.0)<br>• その他 → 安定(0.5) | カテゴリ変数をエンコード<br>increasing: 1.0<br>stable: 0.5<br>decreasing: 0.0 |
| 7 | 協力スコア | 協力的な活動の割合<br>(= review, merge, collaboration, mentoring の回数 / 総活動数) | 0-1の範囲（事前正規化済み） |
| 8 | コード品質スコア | 品質向上活動の割合<br>(= test, doc, refactor, fix の回数 / 総活動数) | 0-1の範囲（事前正規化済み） |
| 9 | 最近の受諾率 | 直近30日のレビュー依頼受諾率<br>(= 受諾数 / (受諾数 + 拒否数)) | 0-1の範囲（事前正規化済み） |
| 10 | レビュー負荷 | 現在の負荷の相対値<br>(= 直近30日の未完了レビュー数 / 通常の平均レビュー数) | 0-1に正規化、1.0以上はキャップ |

**重要**: すべての状態特徴量は0-1の範囲に正規化されている。これにより、異なる単位の特徴量を同じ尺度で扱い、ニューラルネットワークの学習を安定化させる。

---

## 表4.3: 行動特徴量（4次元） - Nova単体プロジェクト用

**注**: 本研究ではNova単一プロジェクトを対象としているため、マルチプロジェクト特徴量（プロジェクト横断行動フラグ1次元）は使用していない。

| # | 特徴量名 | 定義 | 正規化方法 |
|---|---------|------|-----------|
| 1 | 強度（ファイル数） | 1回のレビューで変更されたファイル数<br>ファイル数が多いほど高負荷なレビュー | 0-1の範囲（事前正規化済み） |
| 2 | 協力度 | そのレビュイーを過去にレビューした回数<br>協力関係の強さを示す | 0-1の範囲（事前正規化済み） |
| 3 | 応答速度 | レビューリクエストから応答までの素早さ<br>`速度 = 1.0 / (1.0 + 日数 / 3.0)`<br>• 即日応答 → 約1.0<br>• 3日で応答 → 約0.5<br>• 遅い応答 → 0に近づく | 日数を速度に変換し0-1に正規化<br>3日で約0.5になるよう設計 |
| 4 | レビュー規模（行数） | 1回のレビューで変更された総行数<br>行数が多いほど高負荷なレビュー | 0-1の範囲（事前正規化済み） |

**重要な変換**:
- **応答速度**は、元の`response_time`（日数、値が大きいほど遅い）を素早さに変換（値が大きいほど速い）している。
- この変換により、「応答が速い」ことが継続に正の影響を与える場合、正の勾配として解釈できる。

---

## 正規化戦略の説明

本研究では、すべての特徴量を**0-1の範囲に正規化**している。これにより以下の利点がある：

### 1. スケールの統一
異なる単位の特徴量（日数、回数、割合など）を同じ尺度で扱える。

### 2. 学習の安定化
ニューラルネットワークの勾配が安定し、学習効率が向上する。

### 3. 解釈性の向上
0-1の範囲で相対的な重要度を比較可能になる。

### 正規化の2つのパターン

**パターン1: キャッピング（上限クリップ）**
```
正規化値 = min(実測値 / 上限値, 1.0)
```
- 例: `経験日数 = min(days / 730.0, 1.0)`
- 730日(2年)を超えても1.0に固定
- 外れ値の影響を抑制

**パターン2: 事前正規化**
- 例: `最近の活動頻度`（既に0-1）
- データ作成時に正規化済み
- モデル入力時にそのまま使用

---

## マルチプロジェクト特徴量について（本研究では不使用）

将来の拡張として、以下のマルチプロジェクト特徴量が定義されているが、**本研究（Nova単体）では使用していない**：

### 不使用の状態特徴量（4次元）
- `project_count`: 参加プロジェクト数
- `project_activity_distribution`: プロジェクト間の活動分散度
- `main_project_contribution_ratio`: メインプロジェクトへの貢献率
- `cross_project_collaboration_score`: プロジェクト横断協力スコア

### 不使用の行動特徴量（1次元）
- `is_cross_project`: プロジェクト横断的な行動フラグ

これらの特徴量は、複数プロジェクトにまたがるレビュア予測のために設計されている。

---

## 実装上の注意点

### Nova単体用実装
- **ファイル**: `src/review_predictor/model/irl_predictor_nova_single.py`
- **次元設定**: `state_dim=10, action_dim=4`
- **マルチプロジェクト特徴量**: コメントアウト済み

### マルチプロジェクト用実装（参考）
- **ファイル**: `src/review_predictor/model/irl_predictor.py`
- **次元設定**: `state_dim=14, action_dim=5`

---

## 特徴量の時系列的な扱い

本研究では、LSTMを用いた時系列学習を行うため、特徴量は以下のように扱われる：

### 状態特徴量（State）
- **各時点での累積値**:
  - 例: 総レビュー数は、その時点までの累積値
  - 時間経過とともに増加する傾向

### 行動特徴量（Action）
- **各レビュー依頼ごとの値**:
  - 例: 応答速度は、そのレビュー依頼に対する応答の速さ
  - 時点ごとに変動する

### LSTMへの入力
```
state_seq: [batch_size, seq_len, 10]  # 時系列の状態特徴量
action_seq: [batch_size, seq_len, 4]  # 時系列の行動特徴量
```

この時系列的な扱いにより、**活動パターンの変化**（例: 徐々に活動が減少する）を捉えることができる。
